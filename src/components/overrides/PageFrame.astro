---
import MobileMenuToggle from 'virtual:starlight/components/MobileMenuToggle';
import SiteTitle from 'virtual:starlight/components/SiteTitle';

const { hasSidebar } = Astro.locals.starlightRoute;
---

<div class="page sl-flex">
	<header class="header"><slot name="header" /></header>
	{
		hasSidebar && (
			<nav class="sidebar print:hidden" aria-label={Astro.locals.t('sidebarNav.accessibleLabel')}>
				<MobileMenuToggle />
				<div id="starlight__sidebar" class="sidebar-pane">
					<div class="sidebar-content sl-flex">
						<div class="sidebar-content-wrapper">
							<!-- Site Title in Left Sidebar - only shows when both sidebars are present -->
							<div class="sidebar-title">
								<SiteTitle />
							</div>
							<slot name="sidebar" />
						</div>
					</div>
				</div>
			</nav>
		)
	}
	<div class="main-frame"><slot /></div>
</div>

<style>
	.page {
		flex-direction: column;
		min-height: 100vh;
	}

	.header {
		z-index: var(--sl-z-index-navbar);
		position: fixed;
		inset-inline-start: 0;
		inset-block-start: 0;
		width: 100%;
		height: var(--sl-nav-height);
		border-bottom: 1px solid var(--sl-color-hairline-shade);
		padding: var(--sl-nav-pad-y) var(--sl-nav-pad-x);
		padding-inline-end: var(--sl-nav-pad-x);
		background-color: var(--sl-color-bg-nav);
	}

	:global([data-has-sidebar]) .header {
		padding-inline-end: calc(var(--sl-nav-gap) + var(--sl-nav-pad-x) + var(--sl-menu-button-size));
	}

	.sidebar-pane {
		visibility: var(--sl-sidebar-visibility, hidden);
		position: fixed;
		z-index: var(--sl-z-index-menu);
		inset-block: var(--sl-nav-height) 0;
		inset-inline-start: 0;
		width: 100%;
		background-color: var(--sl-color-black);
		overflow-y: auto;
	}

	:global([aria-expanded='true']) ~ .sidebar-pane {
		--sl-sidebar-visibility: visible;
	}

	.sidebar-content {
		height: 100%;
		min-height: max-content;
		padding: 1rem var(--sl-sidebar-pad-x) 0;
		flex-direction: column;
		gap: 1rem;
		/* Add padding-top to account for sticky site title */
		padding-top: calc(var(--sl-nav-height) - 1rem);
		/* Remove padding positioning */
		padding-left: var(--sl-sidebar-pad-x);
		padding-right: var(--sl-sidebar-pad-x);
		/* Keep navigation items left-aligned */
		text-align: left;
		align-items: flex-start;
	}

	/* Remove padding-top when TOC collapses (mobile) */
	@media (max-width: 71.99rem) {
		.sidebar-content {
			padding-top: 1rem;
		}
	}

	/* Remove padding-top when TOC is not present on desktop */
	@media (min-width: 72rem) {
		:global(:not([data-has-toc])) .sidebar-content {
			padding-top: 1rem;
		}
		
		/* Keep extra padding when both sidebars are present */
		:global([data-has-sidebar][data-has-toc]) .sidebar-content {
			padding-top: calc(var(--sl-nav-height) - 1rem);
		}
	}

	/* Wrapper for all sidebar content */
	.sidebar-content-wrapper {
		width: 100%;
		display: flex;
		flex-direction: column;
		gap: 1rem;
		/* Float to the right side of the sidebar container */
		align-self: flex-end;
		width: calc(var(--sl-sidebar-width) * 0.7);
	}

	/* Mobile view - remove right float and use full width */
	@media (max-width: 71.99rem) {
		.sidebar-content-wrapper {
			align-self: stretch;
			width: 100%;
		}
	}

	/* Site Title Styles */
	.sidebar-title {
		position: sticky;
		top: 0;
		z-index: 10;
		padding: 1rem 0;
		border-bottom: 1px solid var(--sl-color-hairline);
		margin-bottom: 1rem;
		/* Hidden by default on mobile */
		display: none;
		/* Align with header */
		margin-top: calc(-1 * var(--sl-nav-height));
		padding-top: calc(var(--sl-nav-height) + 1rem);
		background-color: var(--sl-color-bg-sidebar);
		/* Remove padding positioning */
		padding-left: 0;
		padding-right: 0;
		/* Keep left alignment for content */
		text-align: left;
		align-self: flex-start;
		width: 100%;
	}

	.site-title {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		text-decoration: none;
		color: var(--sl-color-white);
		font-weight: 600;
		font-size: 1.25rem;
		transition: opacity 0.2s ease;
		/* Keep left alignment */
		justify-content: flex-start;
		width: 100%;
	}

	.site-title:hover {
		opacity: 0.8;
	}

	.site-logo {
		height: 2rem;
		width: auto;
	}

	.site-name {
		font-size: 1.5rem;
		font-weight: 700;
	}

	@media (min-width: 50rem) {
		.sidebar-content::after {
			content: '';
			padding-bottom: 1px;
		}
	}

	.main-frame {
		padding-top: calc(var(--sl-nav-height) + var(--sl-mobile-toc-height));
		padding-inline-start: var(--sl-content-inline-start);
	}

	@media (min-width: 50rem) {
		:global([data-has-sidebar]) .header {
			padding-inline-end: var(--sl-nav-pad-x);
		}
		.sidebar-pane {
			--sl-sidebar-visibility: visible;
			width: var(--sl-sidebar-width);
			background-color: var(--sl-color-bg-sidebar);
			border-inline-end: 1px solid var(--sl-color-hairline-shade);
		}
	}

	/* Make left sidebar thinner and main content wider */
	@media (min-width: 72rem) {
		.sidebar-pane {
			/* Left sidebar takes 20% of screen width */
			width: 20%;
			background-color: var(--sl-color-bg-sidebar);
			border-inline-end: 1px solid var(--sl-color-hairline-shade);
			/* Extend sidebar to top of page */
			inset-block: 0 0;
		}

		/* Header starts where main content begins - always after left sidebar */
		.header {
			inset-inline-start: 20%;
			/* Header spans from left sidebar to right edge */
			width: 80%;
		}

		/* Ensure main content stays centered when both sidebars are present */
		:global([data-has-sidebar][data-has-toc]) .main-frame {
			
			margin-left: 20%;
		}

		/* When TOC is not present, main content can expand more */
		:global([data-has-sidebar]:not([data-has-toc])) .main-frame {
			
			margin-left: 20%;
		}

		/* When left sidebar is not present, main content fills the space */
		:global(:not([data-has-sidebar])) .main-frame {
			margin-left: 0;	
			max-width: calc(100% - var(--sl-content-pad-x) * 2);
			padding-inline-start: 0;
		}

		/* Show sidebar title only when both sidebars are present */
		:global([data-has-sidebar][data-has-toc]) .sidebar-title {
			display: block;
		}

		/* Hide sidebar title when either sidebar is missing */
		:global([data-has-sidebar]:not([data-has-toc])) .sidebar-title {
			display: none;
		}

		:global(:not([data-has-sidebar])) .sidebar-title {
			display: none;
		}

		/* Adjust sidebar title for larger screens */
		.sidebar-title {
			padding: 0.75rem 0;
		}

		.site-title {
			font-size: 1.5rem;
		}

		.site-logo {
			height: 2.5rem;
		}

		.site-name {
			font-size: 1.75rem;
		}
	}

	/* Responsive width adjustments */
	@media (min-width: 90rem) {
		.sidebar-pane {
			width: 20%;
		}

		.header {
			inset-inline-start: 20%;
			width: 80%;
		}
	}

	@media (min-width: 120rem) {
		.sidebar-pane {
			width: 20%;
		}

		.header {
			inset-inline-start: 20%;
			width: 80%;
		}
	}

	@media (min-width: 160rem) {
		.sidebar-pane {
			width: 20%;
		}

		.header {
			inset-inline-start: 20%;
			width: 80%;
		}
	}

	@media (min-width: 200rem) {
		.sidebar-pane {
			width: 20%;
		}

		.header {
			inset-inline-start: 20%;
			width: 80%;
		}
	}

	@media (min-width: 240rem) {
		.sidebar-pane {
			width: 20%;
		}

		.header {
			inset-inline-start: 20%;
			width: 80%;
		}
	}

</style> 