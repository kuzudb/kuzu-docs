---
title: "LLM extension"
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

The `llm` extension allows you to use LLMs from different providers directly from Kuzu using Cypher.

Currently, this extension provides the following function:

- `CREATE_EMBEDDING`: Create embeddings from text

:::note[Note]
In the future, we plan to add more functions to this extension, such as sending queries to LLMs directly from Kuzu.
:::

## Usage

```sql
INSTALL llm;
LOAD llm;
```

## Create embeddings

The `CREATE_EMBEDDING` function allows you to create embeddings from text using the following providers:

* [Amazon Bedrock](https://docs.aws.amazon.com/bedrock/latest/userguide/titan-embedding-models.html)
* [Google Vertex](https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings)
* [Google Gemini](https://ai.google.dev/gemini-api/docs/embeddings)
* [Ollama](https://ollama.com/blog/embedding-models)
* [OpenAI](https://platform.openai.com/docs/guides/embeddings)
* [Voyage AI](https://docs.voyageai.com/docs/embeddings)

The general form of the function is shown below. It returns an embedding of type `LIST[FLOAT]`.

```cypher
CREATE_EMBEDDING(
    // Required arguments
    <PROMPT>,
    <PROVIDER>,
    <MODEL>
    // Optional provider-specific arguments
    <DIMENSIONS>,
    <REGION or ENDPOINT>
);
```

Required arguments:

- `PROMPT`: The input text to embed.
    - Type: `STRING`
- `PROVIDER`: The embedding provider.
    - Type: `STRING`
- `MODEL`: The identifier of the embedding model.
    - Type: `STRING`

Optional arguments:

- `DIMENSIONS`: The size of the embedding vector.
    - Type: `INT64`
    - Default: See provider API reference
    - Note: This value must be positive.
- `REGION`: The region to send requests to.
    - Type: `STRING`
    - Default: `None` (If a provider supports this argument it must be specified).
- `ENDPOINT`: The endpoint to send requests to.
    - Type: `STRING`
    - Default: `http://localhost:11434`

The following table shows the optional arguments supported by each provider:

| Provider | `dimensions` | `region` | `endpoint` |
| --- | --- | --- | --- |
| `amazon-bedrock` | - | Yes | - |
| `google-vertex` | Yes | Yes | - |
| `google-gemini` | - | - | - |
| `open-ai` | Yes | - | - |
| `voyage-ai` | Yes | - | - |
| `ollama` | - | - | Yes |

:::note[Note]
If an unsupported model, dimension, region, or endpoint is specified, the API call to the provider will fail. Check the provider's API documentation for the currently supported options.
:::

### Configuration

To allow API calls to the providers, you must set the appropriate environment variables:

| Provider | Required Environment Variables |
| --- | --- |
| `amazon-bedrock` | `AWS_ACCESS_KEY`, `AWS_SECRET_ACCESS_KEY` |
| `google-vertex` | `GOOGLE_CLOUD_PROJECT_ID`, `GOOGLE_VERTEX_ACCESS_KEY` |
| `google-gemini` | `GOOGLE_GEMINI_API_KEY` |
| `open-ai` | `OPENAI_API_KEY` |
| `voyage-ai` | `VOYAGE_API_KEY` |
| `ollama` | None |

### Examples

```cypher
RETURN CREATE_EMBEDDING(
    "Hello world",
    "amazon-bedrock",
    "amazon.titan-embed-text-v1",
    "us-east-1"                          // Optional region
);

RETURN CREATE_EMBEDDING(
    "Hello world",
    "google-gemini",
    "gemini-embedding-exp-03-07"
);
RETURN CREATE_EMBEDDING(
    "Hello world",
    "google-vertex",
    "gemini-embedding-001",
    256,                                // Optional dimensions
    "us-east1"                          // Optional region
);

RETURN CREATE_EMBEDDING(
    "Hello world",
    "ollama",
    "nomic-embed-text"
);
RETURN CREATE_EMBEDDING(
    "Hello world",
    "ollama",
    "nomic-embed-text",
    "http://endpoint.example.com:8000" // Optional endpoint
);

RETURN CREATE_EMBEDDING(
    "Hello world",
    "voyage-ai",
    "voyage-3-large",
    512                                 // Optional dimensions
);
```

### Storing embeddings in a vector index

The `CREATE_EMBEDDING` function can be used together with the `vector` extension to store and search embeddings
directly in Kuzu. Refer to the [vector search docs](/extensions/vector) for an example.
